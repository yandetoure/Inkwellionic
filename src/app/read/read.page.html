<ion-header [translucent]="true">
  <ion-toolbar class="header-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab1"></ion-back-button>
    </ion-buttons>
    <div class="header-center" *ngIf="book">
      <p class="book-title">{{ book.title }}</p>
      <p class="chapter-subtitle" *ngIf="chapter">Chapitre {{ chapter.number }}</p>
    </div>
    <ion-buttons slot="end">
      <ion-button (click)="toggleMenu()">
        <ion-icon name="list-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div *ngIf="chapter as c" class="chapter-content">
    <h1 class="chapter-title">Chapitre {{ c.number }}: {{ c.title }}</h1>
    <p class="chapter-meta">{{ actualWordCount }} mots</p>
    
    <div class="prose">
      <p class="chapter-text">{{ c.content }}</p>
    </div>
  </div>
</ion-content>

<!-- Action Bar -->
<div class="action-bar">
  <div class="action-buttons">
    <button class="action-btn" (click)="toggleLike()" [class.liked]="isLiked">
      <ion-icon [name]="isLiked ? 'heart' : 'heart-outline'"></ion-icon>
      <span>{{ likes }}</span>
    </button>
    <button class="action-btn" (click)="toggleComments()">
      <ion-icon name="chatbubble-outline"></ion-icon>
      <span>{{ commentsCount }}</span>
    </button>
    <button class="action-btn" (click)="share()">
      <ion-icon name="share-outline"></ion-icon>
      <span>Partager</span>
    </button>
  </div>
</div>

<!-- Overlay -->
<div class="overlay" [class.active]="isMenuOpen" (click)="toggleMenu()"></div>

<!-- Slide Menu -->
<div class="slide-menu" [class.active]="isMenuOpen">
  <div class="menu-header" *ngIf="book">
    <div class="book-info">
      <img *ngIf="book.cover" [src]="book.cover" alt="cover" class="book-cover" />
      <div class="book-details">
        <h3>{{ book.title }}</h3>
        <p *ngIf="book.author" class="author">{{ book.author }}</p>
      </div>
    </div>
    <ion-button fill="clear" (click)="toggleMenu()">
      <ion-icon name="close-outline"></ion-icon>
    </ion-button>
  </div>
  <div class="menu-content">
    <div 
      *ngFor="let ch of chapters" 
      class="chapter-item"
      [class.current]="ch.id === chapterId"
      [class.locked]="ch.isPaid && ch.id !== chapterId"
      (click)="selectChapter(ch)">
      <div class="chapter-number" [class.locked-icon]="ch.isPaid && ch.id !== chapterId">
        <ion-icon *ngIf="ch.isPaid && ch.id !== chapterId" name="lock-closed-outline"></ion-icon>
        <span *ngIf="!(ch.isPaid && ch.id !== chapterId)">{{ ch.number }}</span>
      </div>
      <div class="chapter-info">
        <h3>Chapitre {{ ch.number }}: {{ ch.title }}</h3>
        <p *ngIf="ch.wordCount">{{ ch.wordCount }} mots</p>
        <div class="chapter-stats">
          <span *ngIf="ch.likes">
            <ion-icon name="heart-outline"></ion-icon>
            {{ ch.likes }}
          </span>
          <span *ngIf="ch.views">
            <ion-icon name="eye-outline"></ion-icon>
            {{ ch.views }}
          </span>
        </div>
        <ion-badge *ngIf="ch.isPaid && ch.id !== chapterId" color="warning">
          {{ ch.coinCost }} ðŸª™
        </ion-badge>
      </div>
    </div>
  </div>
</div>

